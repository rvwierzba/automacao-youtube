name: Automação de Vídeos

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1) Checkout
      - name: Checkout
        uses: actions/checkout@v3

      # 2) Setup Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.9

      # 3) Criar e instalar no venv
      - name: Create and Install in venv
        run: |
          python -m venv venv
          ./venv/bin/pip install --upgrade pip
          ./venv/bin/pip install -r requirements.txt
          ./venv/bin/pip install moviepy
        shell: bash

      # 4) Guardar o caminho do python do venv
      - name: Save venv python path
        run: echo "PYTHON_VENV=$(pwd)/venv/bin/python" >> $GITHUB_ENV
        shell: bash

      # 5) (Opcional) Listar pacotes instalados
      - name: List Packages
        run: $PYTHON_VENV -m pip list
        shell: bash

      # 6) Desabilitar ImageMagick
      - name: Disable ImageMagick
        run: echo "IMAGEMAGICK_BINARY=/bin/false" >> $GITHUB_ENV
        shell: bash

      # 7) Rodar script
      - name: Run Main Script
        run: $PYTHON_VENV scripts/main.py
        shell: bash
