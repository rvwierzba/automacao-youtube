name: Build & Upload

on:
  workflow_dispatch: {}  # Para rodar manual
  schedule:
    - cron: "0 5,19 * * *"  # 5h e 19h diários

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do Código
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Install & Run
        shell: bash
        run: |
          echo "IMAGEMAGICK_BINARY=/bin/false" >> $GITHUB_ENV

          python -m venv venv
          source venv/bin/activate
          pip install --upgrade pip
          pip install --no-cache-dir -r requirements.txt

          echo ">>> pip freeze debug:"
          pip freeze

          # 1) Gera texto+áudio+vídeo
          python scripts/main.py --gemini-api "${{ secrets.GEMINI_API_KEY }}" --youtube-channel "${{ secrets.YOUTUBE_CHANNEL_ID }}"

          # 2) Faz Upload no YouTube
          python scripts/upload_youtube.py \
            --video-file "video_final.mp4" \
            --client-secret-file "${{ secrets.CLIENT_SECRET_FILE_FIZZQUIRK }}" \
            --token-file "${{ secrets.TOKEN_FILE_FIZZQUIRK }}" \
            --title "Curiosities Title" \
            --description "Curious facts" \
            --category "22" \
            --tags curiosities facts
